{"version":3,"file":"body.js","sourceRoot":"","sources":["body.ts"],"names":[],"mappings":"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","sourcesContent":["import Vector from '#/core/vector';\nimport { TDrawer } from '#/core/render';\nimport { TShapes } from './shapes/index';\nimport { isNill } from '#/utils';\nimport { Piece, TPieceParams, TUpdateOptions } from './piece';\nimport { SHAPE_TYPES, TShapeTypes } from '#/constants';\n\nconst V = Vector;\n\nexport type TBodyParams = TPieceParams & Pick<\n\tBody,\n\t'position' |\n\t'static' |\n\t'scale' |\n\t'mass' |\n\t'origin' |\n\t'forces' |\n\t'gravity'|\n\t'friction'\n>;\n\nexport class Body extends Piece {\n\tstatic: boolean;\n\tposition: Vector;\n\torigin: Vector;\n\tscale: number;\n\tforces: Vector;\n\tacceleration: Vector;\n\tvelocity: Vector;\n\tangularVelocity: number;\n\tangularAcceleration: number;\n\tangle: number;\n\tmass: number;\n\tgravity: Vector | null;\n\tfriction: number | null;\n\tupdateFn?: (instance: this, dt: number) => void;\n\n    constructor(params: Partial<TBodyParams>) {\n\t\tif (isNill(params?.type)) {\n\t\t\tthrow new Error('Body required params missed!');\n\t\t}\n\n\t\tsuper({\n\t\t\ttype: params.type,\n\t\t\tvisible: params?.visible,\n\t\t\tzIndex: params?.zIndex,\n\t\t});\n\n\t\tthis.static = params.static ?? false;\n\t\tthis.position = params.position ?? new V(0, 0);\n\t\tthis.origin = params?.origin ?? this.position;\n\t\tthis.scale = 1;\n\t\tthis.forces = params.forces ?? new V(0, 0);\n\t\tthis.acceleration = new V(0, 0);\n\t\tthis.velocity = new V(0, 0);\n\t\tthis.angularVelocity = 0;\n\t\tthis.angularAcceleration = 0;\n\t\tthis.angle = 0;\n\t\tthis.mass = params.mass ?? 1;\n\t\tthis.gravity = params.gravity ?? null;\n\t\tthis.friction = params.friction ?? 0;\n    }\n\n    render(drawer: TDrawer) {\n      \tthis.draw(drawer);\n    };\n\n\tdraw(render: TDrawer) {}\n\n\tsetUpdateFn(fn: (instance: this) => void) {\n\t\tthis.updateFn = fn;\n\t\treturn this;\n\t}\n\n    update(dt: number, options: TUpdateOptions) {\n\t\tif (this.updateFn) {\n\t\t\treturn this.updateFn(this, dt);\n\t\t}\n\n\t\tif (this.static) return;\n\n\t\tconst G = this.gravity ?? options.globalGravity ?? new Vector(0, 0);\n\t\tconst d = dt * 0.01;\n\t\tconst prevPosition = this.position.clone();\n\t\t// console.log(new V(0, 1).toAngle(this.angle))\n\t\t// this.forces.add(new V(0, 1)) // apply gravity\n\n\t// console.log(this.forces.clone().divisionScalar(this.mass))\n\t\tconst F = this.forces.add(G);\n\t\tthis.acceleration.add(F.divScalar(this.mass));\n\t\tthis.velocity.add(this.acceleration);\n\n\t\tthis.position.add(this.velocity.clone().mulScalar(d));\n\n\t\tthis.angularVelocity = this.angularVelocity * d;\n\t\tthis.angle = this.angle + this.angularVelocity;\n\n\t\t// calc speed\n\t\t// this.speed = this.position.clone().sub(prevPosition).divisionScalar(d);\n\t\t// console.log(this.speed.magnitude())\n\t\tthis.acceleration.mulScalar(0);\n\t\t// this.velocity.multiplyScalar(0)\n    };\n\n    collision(obj: TShapes) {\n\t\tif (this.static) return;\n\n\t\t// const objPoints = obj.getTransformedVertices();\n\t\t// const n = V.getNormal(objPoints.topRight, objPoints.topLeft);\n\t\t// // console.log(360 / (2 * Math.PI) * n.angle())\n\t\t// var d = obj.position.y - obj.height / 2\n\t\t// if (this.position.y + this.radius >= d) {\n\t\t// \tthis.velocity.y *= -1;\n\t\t// \tthis.forces.add(n);\n\t\t// \tthis.position.y = d - this.radius\n\t\t// }\n\t\t// this.forces.add(new V(-110, -110));\n    }\n}\n"]}